<html>
<head>
<title>CMU 15-418 (Spring 2012) Final Project</title>

<link rel="stylesheet" type="text/css" href="style.css">

</head>
<body>

<div class="constrainedWidth">
  
<div style="padding-bottom: 10px;">
<div class="title smallTitle">CMU 15-418 (Spring 2012) Final Project:</div>
<div class="title" style="width: 900px; padding-bottom: 6px; border-bottom: #000000 2px solid;">
  ISPC Hardware Performance Monitoring Tool
</div>
</div>

<div class="boldText">
<div>Nipunn Koorapati</div>
</div>

<div class="section">Reports</div>

<div class="">
<p><a href="proposal.html">Project Proposal</a></p>
<p><a href="checkpoint.html">Checkpoint Report</a></p>
<p><a href="finalreport.html">Final Report</a></p>
</div>

<div class="section">Working Schedule</div>

<p>
<table class="projectSchedule">
<tr>
  <td width="110"><span style="font-weight: bold;">Week</span></td>
  <td width="380"><span style="font-weight: bold;">What I Plan To Do</span></td>
  <td><span style="font-weight: bold;">What I've Actually Done</span></td>
</tr>
<tr><td>Apr 1-7</td><td>Run x86 code using performance counters</td>
                    <td>Looked at Agner Fog's code. Ran it. </td></tr>
<tr><td>Apr 8-14</td><td>Run/modify aobench example in ISPC;</td>
                     <td>Got up and running on a Sandy Bride box</td></tr>
<tr><td>Apr 15-21</td><td>Emit x86 code in ISPC in interesting spots. Output results</td>
                      <td>Ran and worked through ISPCInstrument code</td></tr>
<tr><td>Apr 22-28</td><td>Analyze results on various ISPC programs</td>
                      <td></td></tr>
<tr><td>Apr 29-May 5</td><td>Output results in visual way</td>
                         <td></td></tr>
<tr><td>May 6-11</td><td>Write example ISPC programs to show features</td>
                     <td></td></tr>
</table>
</p>

<div class="section">Working Log</div>
<p>
3/28: I successfully forked, compiled and built ISPC. That's a win! I also
looked up information on how performance counters work. There's a lot
of useful information in there.
</p>
<p>
3/31: Emailed Matt Pharr. Got idea of general steps involved. He linked me
Agner Fog's code example. Hopefully that should help.
</p>
<p>
4/12: Downloaded and dug around Agner Fog's code example for using perf
counters. His code is pretty complicated, but it boils down to something
simple. The RDPMC instruction in x86-64 reads performance monitoring
couners. They can be reset with another instruction. Complexity arises
when checking for what architecture is being used, but hopefully I
won't need to worry about that.
</p>
<p>
4/20: Made commit to ISPC for suggestions for typo'd labels. This was to
get a hang of the code emitting classes within ISPC. I used a string-distance
function to find similar labels and suggest them (in goto statements).
Honestly, I don't think it helped me that much, but it was fun!
</p>
<p>
4/21: Ran aobench_instrumented code and looked at the underlying ispc
code. I also ran sqrt code from asst1 with --instrumented. It runs
WAY WAY slower with instrumentation on. Like 100x slower.
Hardware performance counters aren't going to be particularly
useful with slowdowns like that. It's possible that the slowdown
is due to the function call and once replaced with an inline
hardware counter increment, it won't be nearly as slow.
Current instrumentation
code returns the mask, so we can already look at lane active percentage.
IPC would be an interesting extra stat though.
</p>
<p>
4/24: Just realized why Agner Fog's code was so complex. The RDPMC
and RDMSR instructions (for reading performance counters and machine-specific
registers) are privileged instructions! He wrote a driver for accessing
these registers. Furthermore, if you put bad register values into the driver,
the driver will crash (AKA blue screen), so he wrapped the driver in a
safe way. My guess is that he didn't want to make the driver robust for
performance reasons. I'll send him an email.
</p>

</div>

</div>

</body>
</html>
